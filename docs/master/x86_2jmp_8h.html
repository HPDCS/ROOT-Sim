<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>The ROme OpTimistic Simulator: src/arch/x86/jmp.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="flatdoc.css" rel="stylesheet" type="text/css"/>
<link href="inline-params.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="rs.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">The ROme OpTimistic Simulator
   &#160;<span id="projectnumber">2.0.0</span>
   </div>
   <div id="projectbrief">A General-Purpose Multithreaded Parallel/Distributed Simulation Platform</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('x86_2jmp_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">jmp.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>x86 ULT support header  
<a href="#details">More...</a></p>
<div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> This graph shows which files directly or indirectly include this file:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="x86_2jmp_8h__dep__incl.png" border="0" usemap="#src_2arch_2x86_2jmp_8hdep" alt=""/></div>
<map name="src_2arch_2x86_2jmp_8hdep" id="src_2arch_2x86_2jmp_8hdep">
<area shape="rect" id="node2" href="jmp_8h.html" title="Architecture&#45;independent ULT header. " alt="" coords="3061,80,3174,107"/>
<area shape="rect" id="node3" href="ult_8h.html" title="User&#45;Level Threads Headers. " alt="" coords="3065,155,3170,181"/>
<area shape="rect" id="node4" href="ult_8c.html" title="User&#45;Level Threads. " alt="" coords="391,304,495,331"/>
<area shape="rect" id="node5" href="ecs_8c.html" title="Event &amp; Cross State Synchornization. " alt="" coords="5393,453,5501,480"/>
<area shape="rect" id="node6" href="process_8h.html" title="LP control blocks. " alt="" coords="3031,229,3204,256"/>
<area shape="rect" id="node26" href="scheduler_8h.html" title="The ROOT&#45;Sim scheduler main module header. " alt="" coords="2868,379,3052,405"/>
<area shape="rect" id="node34" href="scheduler_8c.html" title="The ROOT&#45;Sim scheduler main module. " alt="" coords="4150,453,4333,480"/>
<area shape="rect" id="node7" href="communication_8c.html" title="Communication Routines. " alt="" coords="939,453,1197,480"/>
<area shape="rect" id="node8" href="core_8c.html" title="Core ROOT&#45;Sim functionalities. " alt="" coords="1554,453,1670,480"/>
<area shape="rect" id="node9" href="init_8c.html" title="Initialization routines. " alt="" coords="520,453,627,480"/>
<area shape="rect" id="node10" href="ccgs_8c.html" title="Consistent and Committed Global State. " alt="" coords="1221,453,1331,480"/>
<area shape="rect" id="node11" href="fossil_8c.html" title="Housekeeping operations. " alt="" coords="2489,453,2601,480"/>
<area shape="rect" id="node12" href="gvt_2gvt_8c.html" title="Global Virtual Time. " alt="" coords="651,453,751,480"/>
<area shape="rect" id="node13" href="numerical_8c.html" title="Numerical Library. " alt="" coords="2327,453,2465,480"/>
<area shape="rect" id="node14" href="costs_8c_source.html" title="src/lib/topology/costs.c" alt="" coords="4357,453,4523,480"/>
<area shape="rect" id="node15" href="obstacles_8c_source.html" title="src/lib/topology/obstacles.c" alt="" coords="4548,453,4743,480"/>
<area shape="rect" id="node16" href="probabilities_8c_source.html" title="src/lib/topology/probabilities.c" alt="" coords="4767,453,4977,480"/>
<area shape="rect" id="node17" href="topology_8c_source.html" title="src/lib/topology/topology.c" alt="" coords="2997,453,3184,480"/>
<area shape="rect" id="node18" href="main_8c.html" title="This module contains the entry point for the simulator, and some core functions. " alt="" coords="776,453,864,480"/>
<area shape="rect" id="node19" href="buddy_8c.html" title="A Buddy System implementation. " alt="" coords="3796,304,3919,331"/>
<area shape="rect" id="node20" href="checkpoints_8c.html" title="State saving and restore for model state buffers. " alt="" coords="3801,453,3964,480"/>
<area shape="rect" id="node21" href="segment_8c.html" title="Segment allocator. " alt="" coords="3943,304,4086,331"/>
<area shape="rect" id="node22" href="state_8c.html" title="LP state management. " alt="" coords="2625,453,2743,480"/>
<area shape="rect" id="node23" href="queues_8c.html" title="Message queueing subsystem. " alt="" coords="2819,453,2973,480"/>
<area shape="rect" id="node24" href="queues_8h.html" title="Message queueing subsystem. " alt="" coords="2753,304,2908,331"/>
<area shape="rect" id="node30" href="binding_8c.html" title="Load sharing rules across worker threads. " alt="" coords="3609,453,3777,480"/>
<area shape="rect" id="node31" href="control_8c.html" title="Processing points for control messages. " alt="" coords="5001,453,5167,480"/>
<area shape="rect" id="node32" href="preempt_8c.html" title="LP preemption management. " alt="" coords="5191,453,5369,480"/>
<area shape="rect" id="node33" href="process_8c.html" title="Generic LP management functions. " alt="" coords="3413,453,3585,480"/>
<area shape="rect" id="node35" href="stf_8c.html" title="O(n) scheduling algorithm. " alt="" coords="3989,453,4126,480"/>
<area shape="rect" id="node37" href="statistics_8c.html" title="Statistics module. " alt="" coords="1355,453,1530,480"/>
<area shape="rect" id="node38" href="stf_8h.html" title="O(n) scheduling algorithm. " alt="" coords="3177,304,3316,331"/>
<area shape="rect" id="node39" href="statistics_8h.html" title="Statistics module. " alt="" coords="1778,304,1953,331"/>
<area shape="rect" id="node25" href="mpi_8c.html" title="MPI Support Module. " alt="" coords="241,528,423,555"/>
<area shape="rect" id="node27" href="abm__layer_8c.html" title="This file contains the implementation of the the agent based modeling interface offered by ROOT&#45;Sim..." alt="" coords="2002,453,2142,480"/>
<area shape="rect" id="node28" href="wrapper_8c.html" title="stdlib wrapper " alt="" coords="3209,453,3389,480"/>
<area shape="rect" id="node29" href="dymelor_8c.html" title="Dynamic Memory Logger and Restorer (DyMeLoR) " alt="" coords="2166,453,2303,480"/>
<area shape="rect" id="node36" href="serial_8c.html" title="Serial scheduler. " alt="" coords="1695,453,1823,480"/>
<area shape="rect" id="node40" href="mpi_8h.html" title="MPI Support Module. " alt="" coords="620,379,804,405"/>
<area shape="rect" id="node44" href="init_8h.html" title="Initialization routines. " alt="" coords="1858,379,1966,405"/>
<area shape="rect" id="node41" href="communication_2gvt_8c.html" title="Distributed GVT Support module. " alt="" coords="317,453,496,480"/>
<area shape="rect" id="node42" href="wnd_8c.html" title="Message delivery support. " alt="" coords="5,528,189,555"/>
<area shape="rect" id="node43" href="wnd_8h.html" title="Message delivery support. " alt="" coords="57,453,242,480"/>
<area shape="rect" id="node45" href="thread_8c.html" title="Generic thread management facilities. " alt="" coords="1847,453,1977,480"/>
</map>
</div>
</div>
<p><a href="x86_2jmp_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct____exec__context__t.html">__exec_context_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This structure describes the CPU context of a User-Level Thread.  <a href="struct____exec__context__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a27b53df10e215ef74cf2825bd336b363"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86_2jmp_8h.html#a27b53df10e215ef74cf2825bd336b363">set_jmp</a>(env)</td></tr>
<tr class="separator:a27b53df10e215ef74cf2825bd336b363"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a932eb25d1cb178ce109c7d35b781878f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86_2jmp_8h.html#a932eb25d1cb178ce109c7d35b781878f">long_jmp</a>(env,  val)&#160;&#160;&#160;<a class="el" href="x86_2jmp_8h.html#afedc6489f0f58a20eace94d2eb2c9790">_long_jmp</a>(env, val)</td></tr>
<tr class="separator:a932eb25d1cb178ce109c7d35b781878f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ab9635d076084c7159b922aa3f22d7e1e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab9635d076084c7159b922aa3f22d7e1e"></a>
typedef struct <a class="el" href="struct____exec__context__t.html">__exec_context_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86_2jmp_8h.html#ab9635d076084c7159b922aa3f22d7e1e">exec_context_t</a></td></tr>
<tr class="memdesc:ab9635d076084c7159b922aa3f22d7e1e"><td class="mdescLeft">&#160;</td><td class="mdescRight">This structure describes the CPU context of a User-Level Thread. <br /></td></tr>
<tr class="separator:ab9635d076084c7159b922aa3f22d7e1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7eb9aee55f31c041377c9cd33ffb33cc"><td class="memItemLeft" align="right" valign="top">long long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86_2jmp_8h.html#a7eb9aee55f31c041377c9cd33ffb33cc">_set_jmp</a> (<a class="el" href="x86_2jmp_8h.html#ab9635d076084c7159b922aa3f22d7e1e">exec_context_t</a> *env)</td></tr>
<tr class="separator:a7eb9aee55f31c041377c9cd33ffb33cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afedc6489f0f58a20eace94d2eb2c9790"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86_2jmp_8h.html#afedc6489f0f58a20eace94d2eb2c9790">_long_jmp</a> (<a class="el" href="x86_2jmp_8h.html#ab9635d076084c7159b922aa3f22d7e1e">exec_context_t</a> *env, long long val)</td></tr>
<tr class="separator:afedc6489f0f58a20eace94d2eb2c9790"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4929790c2fa580d14f27b319f28b4236"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86_2jmp_8h.html#a4929790c2fa580d14f27b319f28b4236">context_create</a> (<a class="el" href="x86_2jmp_8h.html#ab9635d076084c7159b922aa3f22d7e1e">exec_context_t</a> *creat, void(*fn)(void *), void *args, void *stack, size_t stack_size)</td></tr>
<tr class="separator:a4929790c2fa580d14f27b319f28b4236"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>x86 ULT support header </p>
<p>This header defines all the facilities to implement User-Level Threads on x86.</p>
<p>The core of the implementation is found in <a class="el" href="jmp_8S_source.html">jmp.S</a> which is written in assembly. <a class="el" href="jmp_8S_source.html">jmp.S</a> is undocumented here, but looking at its source will give an explanation of all the functions and how they behave.</p>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright (C) 2008-2019 HPDCS Group <a href="https://hpdcs.github.io">https://hpdcs.github.io</a></dd></dl>
<p>This file is part of ROOT-Sim (ROme OpTimistic Simulator).</p>
<p>ROOT-Sim is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; only version 3 of the License applies.</p>
<p>ROOT-Sim is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License along with ROOT-Sim; if not, write to the Free Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA</p>
<dl class="section author"><dt>Author</dt><dd>Alessandro Pellegrini</dd></dl>
<dl class="section date"><dt>Date</dt><dd>December, 2015 </dd></dl>

<p>Definition in file <a class="el" href="x86_2jmp_8h_source.html">jmp.h</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a932eb25d1cb178ce109c7d35b781878f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define long_jmp</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">env, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">val&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;<a class="el" href="x86_2jmp_8h.html#afedc6489f0f58a20eace94d2eb2c9790">_long_jmp</a>(env, val)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This macro is a wrapper for <a class="el" href="x86_2jmp_8h.html#afedc6489f0f58a20eace94d2eb2c9790">_long_jmp()</a>. There is no special care to be taken when calling <a class="el" href="x86_2jmp_8h.html#afedc6489f0f58a20eace94d2eb2c9790">_long_jmp()</a>, so this macro is offered only to make uniform the usage of the api.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">env</td><td>A pointer to an <a class="el" href="x86_2jmp_8h.html#ab9635d076084c7159b922aa3f22d7e1e">exec_context_t</a> structure keeping a CPU context to restore. </td></tr>
    <tr><td class="paramname">val</td><td>This is the value returned by <a class="el" href="x86_2jmp_8h.html#a27b53df10e215ef74cf2825bd336b363">set_jmp()</a> when the context specified in env is restored. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="x86_2jmp_8h_source.html#l00109">109</a> of file <a class="el" href="x86_2jmp_8h_source.html">jmp.h</a>.</p>

</div>
</div>
<a class="anchor" id="a27b53df10e215ef74cf2825bd336b363"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define set_jmp</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">env</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">({\</div><div class="line">                int _set_ret;\</div><div class="line">                __asm__ __volatile__ (<span class="stringliteral">&quot;pushq %rdi&quot;</span>); \</div><div class="line">                _set_ret = <a class="code" href="x86_2jmp_8h.html#a7eb9aee55f31c041377c9cd33ffb33cc">_set_jmp</a>(env); \</div><div class="line">                __asm__ __volatile__ (<span class="stringliteral">&quot;add $8, %rsp&quot;</span>); \</div><div class="line">                _set_ret;\</div><div class="line">            })</div><div class="ttc" id="x86_2jmp_8h_html_a7eb9aee55f31c041377c9cd33ffb33cc"><div class="ttname"><a href="x86_2jmp_8h.html#a7eb9aee55f31c041377c9cd33ffb33cc">_set_jmp</a></div><div class="ttdeci">long long _set_jmp(exec_context_t *env)</div></div>
</div><!-- fragment --><p>This macro is a wrapper for <a class="el" href="x86_2jmp_8h.html#a7eb9aee55f31c041377c9cd33ffb33cc">_set_jmp()</a>, which is the custom implementation of the standard setjmp used in ROOT-Sim. The goal of the wrapper is the following. <a class="el" href="x86_2jmp_8h.html#a7eb9aee55f31c041377c9cd33ffb33cc">_set_jmp()</a> requires one parameter, which is the pointer to an exec_context_t where to store the current context. Since the custom implementation is such that <em>all</em> registers should be saved in the context, not only callee-save as in the standard implementation, simply calling <a class="el" href="x86_2jmp_8h.html#a7eb9aee55f31c041377c9cd33ffb33cc">_set_jmp()</a> clobbers a register which is later not possible to save. This macro pushes the RDI register, used to keep the first parameter of function calls according to SysV ABI, before calling into <a class="el" href="x86_2jmp_8h.html#a7eb9aee55f31c041377c9cd33ffb33cc">_set_jmp()</a>. <a class="el" href="x86_2jmp_8h.html#a7eb9aee55f31c041377c9cd33ffb33cc">_set_jmp()</a> expects this to happen, as it will find the original value of RDI to save on the stack frame of the caller. This is why it is not possible to directly call <a class="el" href="x86_2jmp_8h.html#a7eb9aee55f31c041377c9cd33ffb33cc">_set_jmp()</a> from the code, but this macro must be explicitly used.</p>
<p>The semantics of this macro are the same as the called <a class="el" href="x86_2jmp_8h.html#a7eb9aee55f31c041377c9cd33ffb33cc">_set_jmp()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">env</td><td>A pointer to an exec_context_t structure where to store the current execution contenxt.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if directly called. Otherwise, upon a context restore via <a class="el" href="x86_2jmp_8h.html#a932eb25d1cb178ce109c7d35b781878f">long_jmp()</a>, the return value is set to the value of the second argument passed to <a class="el" href="x86_2jmp_8h.html#a932eb25d1cb178ce109c7d35b781878f">long_jmp()</a>. </dd></dl>

<p>Definition at line <a class="el" href="x86_2jmp_8h_source.html#l00091">91</a> of file <a class="el" href="x86_2jmp_8h_source.html">jmp.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="afedc6489f0f58a20eace94d2eb2c9790"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void _long_jmp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="x86_2jmp_8h.html#ab9635d076084c7159b922aa3f22d7e1e">exec_context_t</a> *&#160;</td>
          <td class="paramname"><em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p><a class="el" href="x86_2jmp_8h.html#afedc6489f0f58a20eace94d2eb2c9790">_long_jmp()</a> is a function implemented in assembly in <a class="el" href="jmp_8S_source.html">jmp.S</a> which restores the whole CPU state (both general purpose registers and FPU registers and state) from the buffer pointed by <code>env</code>.</p>
<p>This function cannot be directly called (it's poisoned). Use the macro <a class="el" href="x86_2jmp_8h.html#a932eb25d1cb178ce109c7d35b781878f">long_jmp</a> instead.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">env</td><td>A pointer to an <a class="el" href="x86_2jmp_8h.html#ab9635d076084c7159b922aa3f22d7e1e">exec_context_t</a> structure where to store the current CPU state </td></tr>
    <tr><td class="paramname">val</td><td>This is the value which is returned from <a class="el" href="x86_2jmp_8h.html#a7eb9aee55f31c041377c9cd33ffb33cc">_set_jmp()</a> when that function returns after that the context in <code>env</code> has been restored.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if directly called. Otherwise, upon a context restore via <a class="el" href="x86_2jmp_8h.html#a932eb25d1cb178ce109c7d35b781878f">long_jmp()</a>, the return value is set to the value of the second argument passed to <a class="el" href="x86_2jmp_8h.html#a932eb25d1cb178ce109c7d35b781878f">long_jmp()</a>.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>Do not call this function: it's poisoned. Use the <a class="el" href="x86_2jmp_8h.html#a932eb25d1cb178ce109c7d35b781878f">long_jmp</a> macro instead. </dd></dl>

</div>
</div>
<a class="anchor" id="a7eb9aee55f31c041377c9cd33ffb33cc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">long long _set_jmp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="x86_2jmp_8h.html#ab9635d076084c7159b922aa3f22d7e1e">exec_context_t</a> *&#160;</td>
          <td class="paramname"><em>env</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p><a class="el" href="x86_2jmp_8h.html#a7eb9aee55f31c041377c9cd33ffb33cc">_set_jmp()</a> is a function implemented in assembly in <a class="el" href="jmp_8S_source.html">jmp.S</a> which saves the whole CPU state (both general purpose registers and FPU registers and state) into the buffer pointed by <code>env</code>.</p>
<p>The semantic of this function is the same as the surrounding macro <a class="el" href="x86_2jmp_8h.html#a27b53df10e215ef74cf2825bd336b363">set_jmp</a>, which should be used instead. Indeed, calling this function will definitely produce a wrong CPU state, because at least the RDI register cannot be saved when directly calling it, due to register clobbering for parameter passing.</p>
<p>Therefore, this function cannot be directly called (it's poisoned).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">env</td><td>A pointer to an <a class="el" href="x86_2jmp_8h.html#ab9635d076084c7159b922aa3f22d7e1e">exec_context_t</a> structure where to store the current CPU state</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if directly called. Otherwise, upon a context restore via <a class="el" href="x86_2jmp_8h.html#a932eb25d1cb178ce109c7d35b781878f">long_jmp()</a>, the return value is set to the value of the second argument passed to <a class="el" href="x86_2jmp_8h.html#a932eb25d1cb178ce109c7d35b781878f">long_jmp()</a>.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>Do not call this function: it's poisoned. Use the <a class="el" href="x86_2jmp_8h.html#a27b53df10e215ef74cf2825bd336b363">set_jmp</a> macro instead. </dd></dl>

</div>
</div>
<a class="anchor" id="a4929790c2fa580d14f27b319f28b4236"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void context_create </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="x86_2jmp_8h.html#ab9635d076084c7159b922aa3f22d7e1e">exec_context_t</a> *&#160;</td>
          <td class="paramname"><em>creat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(void *)&#160;</td>
          <td class="paramname"><em>fn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>args</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>stack</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>stack_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function creates a new User-Level Thread by instantiating a new valid context in <code>env</code>. After that this function returns, the context in <code>env</code> can be safely passed to <a class="el" href="x86_2jmp_8h.html#a932eb25d1cb178ce109c7d35b781878f">long_jmp</a>. The execution will then start from the routine passed in <code>fn</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">creat</td><td>A pointer to an <a class="el" href="x86_2jmp_8h.html#ab9635d076084c7159b922aa3f22d7e1e">exec_context_t</a> structure where the context for the new ULT should be initialized. </td></tr>
    <tr><td class="paramname">fn</td><td>A function pointer which will be the entry point of the ULT once it is first scheduled using <a class="el" href="x86_2jmp_8h.html#a932eb25d1cb178ce109c7d35b781878f">long_jmp</a>. </td></tr>
    <tr><td class="paramname">args</td><td>Arguments to be passed to <code>fn</code> once the context is activated. </td></tr>
    <tr><td class="paramname">stack</td><td>A pointer to a memory area to be used as stack. This memory area must be aligned to 16 bytes on x86. </td></tr>
    <tr><td class="paramname">stack_size</td><td>the size of the memory area pointed by <code>stack</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if directly called. Otherwise, upon a context restore via <a class="el" href="x86_2jmp_8h.html#a932eb25d1cb178ce109c7d35b781878f">long_jmp()</a>, the return value is set to the value of the second argument passed to <a class="el" href="x86_2jmp_8h.html#a932eb25d1cb178ce109c7d35b781878f">long_jmp()</a>. </dd></dl>

<p><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="x86_2jmp_8h_a4929790c2fa580d14f27b319f28b4236_icgraph.png" border="0" usemap="#x86_2jmp_8h_a4929790c2fa580d14f27b319f28b4236_icgraph" alt=""/></div>
<map name="x86_2jmp_8h_a4929790c2fa580d14f27b319f28b4236_icgraph" id="x86_2jmp_8h_a4929790c2fa580d14f27b319f28b4236_icgraph">
<area shape="rect" id="node2" href="ult_8h.html#a21c80d94da97fa7d1476e8450821a701" title="get_ult_stack" alt="" coords="172,5,279,32"/>
</map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_70d5e250c66d001b18da37689179cade.html">arch</a></li><li class="navelem"><a class="el" href="dir_821359b7c7689d1fc53689b7ab64838f.html">x86</a></li><li class="navelem"><a class="el" href="x86_2jmp_8h.html">jmp.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
