#ifndef _ISO_PATCHER_H
#define _ISO_PATCHER_H

#define SWITCH_FUNC "finish_task_switch"
#define MSR_IA32_PERF_GLOBAL_CTRL	    0x38F

typedef void h_func(void);

int switch_patcher_init (unsigned long func_addr);
void switch_patcher_exit(void);
int switch_patcher_state(void);



#define MSR_IA32_PERF_GLOBAL_STATUS_RESET   0x390
#define MSR_IA32_PERF_GLOBAL_STATUS     0x38E
#define MSR_IA32_PERF_GLOBAL_CTRL	    0x38F
#define MSR_IA32_PEBS_ENABLE		    0x3F1
#define MSR_IA32_DS_AREA     		    0x600
#define MSR_IA32_PERF_CABABILITIES  	0x345
#define MSR_IA32_MISC_ENABLE            0x1A0
#define MSR_IA32_PERF_CAPABILITIES      0x345
#define MSR_IA32_DEBUGCTL               0x1D9

/* Performance Event Select Register 0 */
#define MSR_IA32_PERFEVTSEL_ADDRESS		0x00000186
#define MSR_IA32_PERFEVTSEL(x)			(MSR_IA32_PERFEVTSEL_ADDRESS + x)

#define MSR_IA32_PERFEVTSEL0		MSR_IA32_PERFEVTSEL(0)
#define MSR_IA32_PERFEVTSEL1		MSR_IA32_PERFEVTSEL(1)
#define MSR_IA32_PERFEVTSEL2		MSR_IA32_PERFEVTSEL(2)
#define MSR_IA32_PERFEVTSEL3		MSR_IA32_PERFEVTSEL(3)
#define MSR_IA32_PERFEVTSEL4		MSR_IA32_PERFEVTSEL(4)
#define MSR_IA32_PERFEVTSEL5		MSR_IA32_PERFEVTSEL(5)
#define MSR_IA32_PERFEVTSEL6		MSR_IA32_PERFEVTSEL(6)
#define MSR_IA32_PERFEVTSEL7		MSR_IA32_PERFEVTSEL(7)

#define MSR_IA32_PMC_ADDRESS	0xC1
#define MSR_IA32_PMC(x)			(MSR_IA32_PMC_ADDRESS + x)

#define MSR_IA32_PMC0			MSR_IA32_PMC(0)
#define MSR_IA32_PMC1			MSR_IA32_PMC(1)
#define MSR_IA32_PMC2			MSR_IA32_PMC(2)
#define MSR_IA32_PMC3			MSR_IA32_PMC(3)
#define MSR_IA32_PMC4			MSR_IA32_PMC(4)
#define MSR_IA32_PMC5			MSR_IA32_PMC(5)
#define MSR_IA32_PMC6			MSR_IA32_PMC(6)
#define MSR_IA32_PMC7			MSR_IA32_PMC(7)

#endif /* _ISO_PATCHER_H */